<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>OCR chá»n vÃ¹ng theo 4 Ä‘iá»ƒm</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <style>
    canvas { border: 1px solid #ccc; cursor: crosshair; }
    #output { white-space: pre-wrap; background: #f0f0f0; margin-top: 10px; padding: 10px; }
  </style>
</head>
<body>
  <h3>ğŸ“¸ Chá»n áº£nh vÃ  click 4 Ä‘iá»ƒm theo chiá»u kim Ä‘á»“ng há»“</h3>
  <input type="file" id="upload" accept="image/*"><br><br>
  <canvas id="canvas"></canvas>
  <div id="output">ğŸ“ Káº¿t quáº£ OCR sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y...</div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const output = document.getElementById("output");

    let img = new Image();
    let points = [];

    document.getElementById("upload").addEventListener("change", e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        img.onload = () => {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
        };
        img.src = reader.result;
      };
      reader.readAsDataURL(file);
    });

    canvas.addEventListener("click", async e => {
      if (points.length >= 4) return;

      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      points.push({ x, y });

      // Váº½ Ä‘iá»ƒm vá»«a chá»n
      ctx.fillStyle = "red";
      ctx.beginPath();
      ctx.arc(x, y, 5, 0, Math.PI * 2);
      ctx.fill();

      // Khi chá»n Ä‘á»§ 4 Ä‘iá»ƒm, thá»±c hiá»‡n crop vÃ  OCR
      if (points.length === 4) {
        output.innerText = "â³ Äang xá»­ lÃ½ OCR...";

        // Táº¡o canvas táº¡m Ä‘á»ƒ crop vÃ¹ng hÃ¬nh há»c
        const tempCanvas = document.createElement("canvas");
        const tempCtx = tempCanvas.getContext("2d");

        // XÃ¡c Ä‘á»‹nh khung chá»¯ nháº­t má»›i
        const width = Math.hypot(points[1].x - points[0].x, points[1].y - points[0].y);
        const height = Math.hypot(points[3].x - points[0].x, points[3].y - points[0].y);
        tempCanvas.width = width;
        tempCanvas.height = height;

        // Sá»­ dá»¥ng context setTransform Ä‘á»ƒ váº½ tá»« 4 Ä‘iá»ƒm => rectangle má»›i
        const [p0, p1, p2, p3] = points;

        // DÃ¹ng Path2D (Ä‘Æ¡n giáº£n) Ä‘á»ƒ cáº¯t theo vÃ¹ng Ä‘iá»ƒm chá»n
        const path = new Path2D();
        path.moveTo(p0.x, p0.y);
        path.lineTo(p1.x, p1.y);
        path.lineTo(p2.x, p2.y);
        path.lineTo(p3.x, p3.y);
        path.closePath();

        // DÃ¹ng getImageData + putImageData náº¿u khÃ´ng dÃ¹ng opencv.js
        const minX = Math.min(...points.map(p => p.x));
        const minY = Math.min(...points.map(p => p.y));
        const max
