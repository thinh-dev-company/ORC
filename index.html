<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>ZXing + Tesseract OCR (Tiếng Việt)</title>
  <style>
    video, canvas {
      max-width: 100%;
      width: 400px;
      border: 1px solid #ccc;
    }
    #output { margin-top: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>Quét QR/Barcode & Văn bản Tiếng Việt</h2>
  <video id="video" autoplay muted playsinline></video><br />
  <button id="ocrBtn">Quét văn bản (OCR tiếng Việt)</button>

  <p><strong>Mã QR / Barcode:</strong> <span id="barcodeResult">Đang chờ...</span></p>
  <p><strong>Kết quả OCR:</strong></p>
  <div id="output">[Chưa có kết quả]</div>

  <canvas id="canvas" style="display:none;"></canvas>

  <!-- ZXing -->
  <script type="module">
    import { BrowserMultiFormatReader } from 'https://cdn.jsdelivr.net/npm/@zxing/browser@0.1.1/+esm';

    const codeReader = new BrowserMultiFormatReader();
    const video = document.getElementById('video');
    const barcodeResult = document.getElementById('barcodeResult');

    codeReader.decodeFromVideoDevice(null, video, (result, err) => {
      if (result) {
        barcodeResult.textContent = result.getText();
      }
    });
  </script>

  <!-- Tesseract.js -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <script>
    const ocrBtn = document.getElementById('ocrBtn');
    const canvas = document.getElementById('canvas');
    const output = document.getElementById('output');
    const video = document.getElementById('video');

    ocrBtn.addEventListener('click', async () => {
      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      output.textContent = 'Đang quét văn bản...';

      const { data: { text } } = await Tesseract.recognize(
        canvas,
        'vie',  // Ngôn ngữ Tiếng Việt
        {
          logger: m => console.log(m)
        }
      );

      output.textContent = text || '[Không nhận dạng được văn bản]';
    });
  </script>
</body>
</html>
