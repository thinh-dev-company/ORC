<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>QR vÃ  OCR káº¿t há»£p</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.18.6/umd/index.min.js"></script>
  <style>
    canvas { border: 1px solid #ccc; cursor: crosshair; }
    #output { white-space: pre-wrap; background: #f0f0f0; margin-top: 10px; padding: 10px; }
  </style>
</head>
<body>
  <h3>ğŸ“¸ Chá»n áº£nh Ä‘á»ƒ quÃ©t QR vÃ  nháº­n diá»‡n vÄƒn báº£n</h3>
  <input type="file" id="upload" accept="image/*"><br><br>
  <canvas id="canvas"></canvas>
  <div id="output">ğŸ“ Káº¿t quáº£ OCR hoáº·c QR Code sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y...</div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const output = document.getElementById("output");

    let img = new Image();

    document.getElementById("upload").addEventListener("change", e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        img.onload = () => {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          // Kiá»ƒm tra QR Code trÃªn áº£nh
          detectQRCode();
        };
        img.src = reader.result;
      };
      reader.readAsDataURL(file);
    });

    // Kiá»ƒm tra QR Code vá»›i ZXing
    function detectQRCode() {
      const codeReader = new ZXing.BrowserMultiFormatReader();
      codeReader.decodeFromImage(canvas)
        .then(result => {
          output.innerText = "QR Code nháº­n diá»‡n: " + result.text;
        })
        .catch(err => {
          output.innerText = "KhÃ´ng cÃ³ QR Code, tiáº¿n hÃ nh OCR...";
          runOCR();
        });
    }

    // Cháº¡y Tesseract OCR náº¿u khÃ´ng cÃ³ QR Code
    function runOCR() {
      output.innerText = "â³ Äang xá»­ lÃ½ OCR...";
      Tesseract.recognize(
        img, 
        'vie+eng', 
        {
          logger: m => console.log(m)
        }
      ).then(({ data: { text } }) => {
        output.innerText = text || "KhÃ´ng tÃ¬m tháº¥y vÄƒn báº£n trong áº£nh.";
      });
    }
  </script>
</body>
</html>
